<!DOCTYPE html>
<html>
<head>
  <title>Country Tools</title>
  <style>
    :root {
      --primary-color: #2563eb;
      --secondary-color: #1e40af;
      --background-color: #f8fafc;
      --text-color: #1e293b;
      --success-color: #16a34a;
      --error-color: #dc2626;
    }

    body {
      font-family: 'Segoe UI', system-ui, sans-serif;
      margin: 0;
      padding: 2rem;
      background-color: var(--background-color);
      color: var(--text-color);
    }

    .container {
      max-width: 800px;
      margin: 0 auto;
      background: white;
      padding: 2rem;
      border-radius: 0.5rem;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    }

    .menu {
      display: flex;
      gap: 0.5rem;
      margin-bottom: 2rem;
    }

    .menu button {
      padding: 0.75rem 1.5rem;
      border: none;
      border-radius: 0.25rem;
      background-color: var(--primary-color);
      color: white;
      cursor: pointer;
      transition: background-color 0.2s;
    }

    .menu button:hover {
      background-color: var(--secondary-color);
    }

    .form-section {
      display: none;
      margin-top: 1.5rem;
    }

    .form-section.active {
      display: block;
    }

    .form-group {
      margin-bottom: 1.5rem;
    }

    label {
      display: block;
      margin-bottom: 0.5rem;
      font-weight: 500;
    }

    select, input {
      width: 100%;
      padding: 0.75rem;
      border: 1px solid #e2e8f0;
      border-radius: 0.25rem;
      font-size: 1rem;
    }

    button.action-button {
      background-color: var(--primary-color);
      color: white;
      padding: 0.75rem 1.5rem;
      border: none;
      border-radius: 0.25rem;
      cursor: pointer;
      transition: background-color 0.2s;
    }

    button.action-button:hover {
      background-color: var(--secondary-color);
    }

    .output {
      margin-top: 2rem;
      padding: 1.5rem;
      border-radius: 0.25rem;
      background-color: #f1f5f9;
    }

    .success {
      color: var(--success-color);
    }

    .error {
      color: var(--error-color);
    }

    .loading {
      color: #64748b;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Country Tools</h1>
    
    <div class="menu">
      <button data-section="validation">Validation</button>
      <button data-section="generation">Generation</button>
    </div>

    <!-- Validation Section -->
    <div id="validation-section" class="form-section">
      <h2>Validation</h2>
      <div class="form-group">
        <label for="country">Select Country:</label>
        <select id="country"></select>
      </div>
      <div class="form-group">
        <label for="city">Enter City:</label>
        <input type="text" id="city" placeholder="Enter city name">
      </div>
      <div class="form-group">
        <label for="phone">Enter Phone Number:</label>
        <input type="text" id="phone" placeholder="Enter phone number">
      </div>
      <button class="action-button" id="validate">Validate</button>
    </div>

    <!-- Generation Section -->
    <div id="generation-section" class="form-section">
      <h2>Generation</h2>
      <div class="form-group">
        <label for="gen-country">Select Country:</label>
        <select id="gen-country"></select>
      </div>
      <button class="action-button" id="generate">Generate Identity</button>
    </div>

    <div class="output" id="output"></div>
  </div>

  <script>
    // Initialize state
    let countries = [];
    let activeSection = 'validation';

    // DOM Elements
    const sections = {
      validation: document.getElementById('validation-section'),
      generation: document.getElementById('generation-section')
    };

    const output = document.getElementById('output');
    const countrySelect = document.getElementById('country');
    const genCountrySelect = document.getElementById('gen-country');

    // Load countries from local JSON
    async function loadCountries() {
      try {
        const response = await fetch('/data/countries_cities.json');
        if (!response.ok) throw new Error('Failed to load countries');
        
        const data = await response.json();
        countries = data.countries;
        populateDropdowns();
      } catch (error) {
        showError('Failed to load country data: ' + error.message);
      }
    }

    // Populate both dropdowns
    function populateDropdowns() {
      const options = countries.map(country => `
        <option value="${country.code}">
          ${country.name} (${country.phone_code})
        </option>
      `).join('');

      countrySelect.innerHTML = options;
      genCountrySelect.innerHTML = options;
    }

    // Show active section
    function showSection(section) {
      Object.values(sections).forEach(s => s.classList.remove('active'));
      sections[section].classList.add('active');
      activeSection = section;
    }

    // Show loading state
    function showLoading(message) {
      output.innerHTML = `<div class="loading">${message}...</div>`;
    }

    // Show success message
    function showSuccess(message) {
      output.innerHTML = `<div class="success">${message}</div>`;
    }

    // Show error message
    function showError(message) {
      output.innerHTML = `<div class="error">${message}</div>`;
    }

    // Event Listeners
    document.querySelectorAll('.menu button').forEach(button => {
      button.addEventListener('click', () => {
        showSection(button.dataset.section);
      });
    });

    document.getElementById('validate').addEventListener('click', async () => {
      const countryCode = countrySelect.value;
      const city = document.getElementById('city').value;
      const phone = document.getElementById('phone').value;

      showLoading('Validating');

      try {
        const country = countries.find(c => c.code === countryCode);
        if (!country) throw new Error('Country not found');

        const cityValid = country.cities.includes(city);
        const phoneValid = new RegExp(country.phone_pattern).test(phone);

        showSuccess(`
          Validation Results:<br>
          City: ${cityValid ? '✅ Valid' : '❌ Invalid'}<br>
          Phone: ${phoneValid ? '✅ Valid' : '❌ Invalid'}
        `);
      } catch (error) {
        showError(error.message);
      }
    });

    document.getElementById('generate').addEventListener('click', () => {
      const countryCode = genCountrySelect.value;
      showLoading('Generating identity');

      try {
        const country = countries.find(c => c.code === countryCode);
        if (!country) throw new Error('Country not found');

        const identity = {
          country: country.name,
          city: country.cities[Math.floor(Math.random() * country.cities.length)],
          phone: generatePhoneNumber(country.phone_pattern),
          timezone: country.time_zone,
          currency: country.currency
        };

        showSuccess(`
          Generated Identity:<br>
          <pre>${JSON.stringify(identity, null, 2)}</pre>
        `);
      } catch (error) {
        showError(error.message);
      }
    });

    // Helper function to generate phone numbers
    function generatePhoneNumber(pattern) {
      const digits = pattern.match(/\d+/g).join('');
      const length = parseInt(digits);
      let phone = '+';
      for (let i = 0; i < length; i++) {
        phone += Math.floor(Math.random() * 10);
      }
      return phone;
    }

    // Initialization
    loadCountries();
    showSection('validation');
  </script>
</body>
</html>
